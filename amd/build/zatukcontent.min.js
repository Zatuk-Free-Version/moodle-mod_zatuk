/**
 * Defines zatuk content script.
 *
 * @since      Moodle 2.0
 * @copyright  2023 Moodle India
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_zatuk/zatukcontent",["jquery","core/notification","core/templates","core/paged_content_factory","core/str","mod_zatuk/zatuk_repository","mod_zatuk/renderzatuk","core/custom_interaction_events","core/modal_factory"],(function($,Notification,Templates,PagedContentFactory,Str,zatukVideosRepository,RenderZatuk,CustomEvents,ModalFactory){const confirmbox=message=>{ModalFactory.create({body:message,type:ModalFactory.types.ALERT,buttons:{ok:Str.get_string("Thank_you")},removeOnClose:!0}).done((function(modal){modal.show()}))};var length,videosOffset,StatusFilter,SortFilter,SearchFilter,SELECTORS_EMPTY_MESSAGE='[data-region="empty-message"]',SELECTORS_ROOT='[data-region="zatuk-list-container"]',SELECTORS_ZATUK_LIST_CONTENT='[data-region="zatuk-list-content"]',SELECTORS_ZATUK_LIST_LOADING_PLACEHOLDER='[data-region="zatuk-list-loading-placeholder"]',SELECTORS_FILTERS='[data-region="filter"]',SELECTORS_FILTER_OPTION="[data-filter]",SELECTORS_SEARCH_QUERY='[data-filter="searchfilter"]',TEMPLATES_ZATUK_LIST_CONTENT="mod_zatuk/video_list_item",DEFAULT_PAGED_CONTENT_CONFIG={pagingbar:!0,ignoreControlWhileLoading:!0,controlPlacementBottom:!0,ariaLabels:{itemsperpagecomponents:"ariaeventlistpagelimit, mod_timeline"}},hideContent=function(root){root.find(SELECTORS_ZATUK_LIST_CONTENT).addClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).removeClass("hidden")},showContent=function(root){root.find(SELECTORS_ZATUK_LIST_CONTENT).removeClass("hidden"),root.find(SELECTORS_EMPTY_MESSAGE).addClass("hidden")},emptyContent=function(root){root.find(SELECTORS_ZATUK_LIST_CONTENT).empty()},updatePreferences=function(){StatusFilter=$(SELECTORS_ROOT).attr("data-statusfilter"),SearchFilter=$(SELECTORS_ROOT).attr("data-searchquery");var args={statusfilter:StatusFilter,search:SearchFilter,limit:10,offset:videosOffset};return zatukVideosRepository.updatePreferences(args)},loadEventsFromPageData=function(pageData,actions,lastIds,preloadedPages,StatusFilter,videosOffset,videosLimit){var pageNumber=pageData.pageNumber,limit=pageData.limit,lastPageNumber=pageNumber;for(videosOffset=(pageNumber-1)*videosLimit;!lastIds.hasOwnProperty(lastPageNumber);)lastPageNumber--;lastIds[lastPageNumber];var eventsPromise=null;return eventsPromise=preloadedPages&&preloadedPages.hasOwnProperty(pageNumber)?preloadedPages[pageNumber]:function(limit,videosOffset,videosLimit,lastId,StatusFilter){return zatukVideosRepository.uploadedVideos({statusfilter:StatusFilter,sort:SortFilter,limit:limit,search:SearchFilter,offset:videosOffset})}(limit+1,videosOffset,0,0,StatusFilter),eventsPromise.then((function(result){return result.length?result.data:(actions.allItemsLoaded(pageNumber),[])}))},createPagedContent=function(length,pageLimit,preloadedPages,firstLoad,StatusFilter,videosOffset,paginationAriaLabel,additionalConfig){var lastIds={1:0},hasContent=!1,config=$.extend({},DEFAULT_PAGED_CONTENT_CONFIG,additionalConfig);return Str.get_string("ariaeventlistpagelimit","mod_timeline",$.isArray(pageLimit)?pageLimit[0].value:pageLimit).then((function(string){return config.ariaLabels.itemsperpage=string,config.ariaLabels.paginationnav=paginationAriaLabel,string})).then((function(){return PagedContentFactory.createWithTotalAndLimit(length,pageLimit,(function(pagesData,actions){var promises=[];return pagesData.forEach((function(pageData){var pagePromise=loadEventsFromPageData(pageData,actions,lastIds,preloadedPages,StatusFilter,videosOffset,pageLimit).then((function(zatukVideos){return zatukVideos.length?(hasContent=!0,function(zatukVideos){var templateContext=function(zatukVideos){var templateContext={pagingbar:!0,pagingdropdown:!0,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1,videos:[]};return zatukVideos.forEach((function(zatukVideo){templateContext.videos.push(zatukVideo)})),templateContext}(zatukVideos);templateContext.itemsperpage=10;var templateName=TEMPLATES_ZATUK_LIST_CONTENT;return Templates.render(templateName,templateContext)}(zatukVideos)):zatukVideos})).catch(Notification.exception);promises.push(pagePromise)})),$.when.apply($,promises).then((function(){firstLoad.resolve(hasContent)})).catch((function(){firstLoad.resolve(hasContent)})),promises}),config)}))},init=function(root){let pageLimit=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,preloadedPages=arguments.length>2?arguments[2]:void 0,paginationAriaLabel=arguments.length>3?arguments[3]:void 0,additionalConfig=arguments.length>4?arguments[4]:void 0;root=$(void 0!==root?root:SELECTORS_ROOT);var firstLoad=$.Deferred(),zatukListContent=root.find(SELECTORS_ZATUK_LIST_CONTENT),loadingPlaceholder=root.find(SELECTORS_ZATUK_LIST_LOADING_PLACEHOLDER);return length=root.attr("data-length"),videosOffset=root.attr("data-videosOffset"),StatusFilter=root.attr("data-statusfilter"),SortFilter=root.attr("data-sortfilter"),SearchFilter=root.attr("data-searchquery"),emptyContent(root),showContent(root),loadingPlaceholder.removeClass("hidden"),createPagedContent(length,pageLimit,preloadedPages,firstLoad,StatusFilter,videosOffset,paginationAriaLabel,additionalConfig).then((function(html,js){return(html=$(html)).addClass("hidden"),Templates.replaceNodeContents(zatukListContent,html,js),firstLoad.then((function(hasContent){if(html.removeClass("hidden"),loadingPlaceholder.addClass("hidden"),!hasContent){hideContent(root);confirmbox('<div class="d-flex justify-content-center align-items-centerflex-column w-100 p-3 zatuknodatadialogue_content"><div class="icon"></div><h4 class="my-3"> No Records Found.</h4></div>')}return hasContent})).catch((function(){return!1})),html})).catch(Notification.exception)};return{init:init,rootSelector:SELECTORS_ROOT,registerSelector:function(root){var Selector=(root=$(void 0!==root?root:SELECTORS_ROOT)).find(SELECTORS_FILTERS),searchInput=root.find(SELECTORS_SEARCH_QUERY);CustomEvents.define(Selector,[CustomEvents.events.activate]),$("#id_search").on("click",(function(){var query=$(searchInput).val();root.attr("data-searchquery",query),updatePreferences().then((function(result){root.attr("data-length",result.length),init()}))})),Selector.on(CustomEvents.events.activate,SELECTORS_FILTER_OPTION,(function(e,data){var option=$(e.target),filter=option.attr("data-filter");root.attr("data-"+filter,option.attr("data-value")),updatePreferences().then((function(result){root.attr("data-length",result.length),init()})),data.originalEvent.preventDefault()}))}}}));

//# sourceMappingURL=zatukcontent.min.js.map